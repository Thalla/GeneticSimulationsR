---
title: Explorative analysis
output:
  html_document:
    df_print: paged
---

```{r init libraries, include=FALSE}
library(flextable)
library(data.table)
library(igraph)
#library(descr)
library(summarytools)
library(ggplot2)
```


```{r init base variables, eval=FALSE, include=FALSE}
config <- c()
originalFitnessData <- c()
fitnessPaths <- c()
```


```{r read data, eval=FALSE, include=FALSE}
newConfig <- c()
newFitness <- c()
counted <- data.table()
fitness <- c()
fitnessIds <- c()
lengths <- c()
values <- c()

# read config
  basePath <- "G:/Hanna/SimulationTree/selection_false/translMethod_affinity/"
  configPath1 <- paste(basePath, "config_64_48_3_2.csv", sep = "")
  basePath <- "G:/Hanna/SimulationTree/selection_false/translMethod_random/"
  #configPath2 <- paste(basePath, "config.csv", sep = "")
  basePath <- "G:/Hanna/SimulationTree/selection_false/translMethod_max/"
  #configPath3 <- paste(basePath, "config.csv", sep = "")
  #configPath <- rbind(configPath1, configPath2, configPath3)
  #newConfig <- apply(configPath, FUN = function(path){data.table::fread(path)}, MARGIN = 1)
  newConfig <- data.table::fread(configPath1)
  
  # set column names
  colnames(newConfig) <- c("translationType", "mrnaSeed", "codonNumb", "geneLength", "geneNumb", "mrnaId", "initAaNumb", "similarAars", "maxAnticodonNumb", "aarsLifeticksStartValue", "livingAarsStartNumb", "livingAarsSeed", "outputSeed", "addToOutput", "mrnaPath", "aarsPath", "livingAarsPath", "livingAarsDir")
  
  # delete gene lengths because it is always three
  newConfig$geneLength <- NULL
  # delete addToOutput because it is not relevant for the data analysis
  newConfig$addToOutput <- NULL
  
  # set factors
  newConfig$translationType <- factor(newConfig$translationType)
  newConfig$mrnaSeed <- factor(newConfig$mrnaSeed)
  newConfig$mrnaId <- factor(newConfig$mrnaId)
  newConfig$similarAars <- factor(newConfig$similarAars)
  newConfig$livingAarsSeed <- factor(newConfig$livingAarsSeed)
  newConfig$outputSeed <- factor(newConfig$outputSeed)
  
  #get fitness paths
  outputPath <- paste(newConfig$livingAarsDir, paste("output_s", newConfig$outputSeed, sep = ""), sep = "")
  fitnessPaths <- paste(outputPath, "codeTableFitness.csv", sep = "\\")
  
  # read fitness values from paths
  fitnessPathsLength <- length(fitnessPaths)
  fPathsToProcess <- fitnessPaths
  maxToTake <- 46080
  if (fitnessPathsLength > maxToTake){
    fPathsToProcess <- head(fitnessPaths, maxToTake)
    fitnessPaths <- tail(fitnessPaths, fitnessPathsLength - maxToTake)
  }
  indices <- c(1:length(fPathsToProcess))
  newFitness <- sapply(indices, FUN = function (pos){data.table::fread(fPathsToProcess[pos])})
  originalFitnessData <- c(originalFitnessData, newFitness)
  
  #add number of simulation steps 
  simulationSteps <- sapply(indices, FUN = function(pos){length(originalFitnessData[[pos]])})
  #simulationSteps <- factor(simulationSteps)
  newConfig <- cbind(simulationSteps, newConfig) 
  
  #delete all 0.0 fitness values in fitness data
  fitness <- originalFitnessData
  fitness <- sapply(indices,FUN =  function(pos){fitness[[pos]][which(fitness[[pos]] > 0)]})
  
  #count number of generations that the cell lived
  notNullValues <- sapply(indices,FUN =  function(pos){length(fitness[[pos]])})
  newConfig <- cbind(notNullValues, newConfig)
  
  #not because the other simulaitons have the same start failure so removing it here would be unfair
  #delete the first 20 elements of every simulation that is after 100.000 steps still living
  #sapply(c(1:5),FUN =  function(pos){if(newConfig$notNullValues[[pos]] == 100000){tail(fitness[[pos]], #length(fitness[[pos]]-20))}else{fitness[[pos]]}})
  
  #summarize fitness data
  indices <- c(1:length(fitness))
  descrStatistics <- sapply(indices, FUN = function(pos){descr(fitness[[pos]], style = "rmarkdown", stats = c("mean", "sd", "min", "q1", "med", "q3", "max", "mad", "iqr", "cv", "skewness", "se.skewness", "kurtosis"))})
  descrStatistics <- data.table(t(descrStatistics))
  colnames(descrStatistics) <- c("mean", "sd", "min", "q1", "med", "q3", "max", "mad", "iqr", "cv", "skewness", "se.skewness", "kurtosis")
  newConfig <- cbind(descrStatistics, newConfig)
  


  
```

```{r add end state column, eval=FALSE, include=FALSE}
endState <- c()
endState[which(config$notNullValues == config$simulationSteps & config$simulationSteps == 2000 & config$max != 1.0 & config$med != config$q3)] <- "unsteady"
endState[which(config$notNullValues == config$simulationSteps & config$simulationSteps == 2000 & config$max != 1.0 & config$med == config$q3)] <- "steady"
endState[which(notNullValues != simulationSteps)] <- "dead"
endState[which(notNullValues == simulationSteps & max == 1.0)] <- "alive"

newConfig <- cbind(endState, newConfig)
```

```{r write descriptive statistics to file, eval=FALSE, include=FALSE}
statsToPrint <- data.table(simulationSteps)
statsToPrint <- cbind(notNullValues, statsToPrint)
statsToPrint <- cbind(descrStatistics, statsToPrint)
colnames(statsToPrint) <- c("mean", "sd", "min", "q1", "med", "q3", "max", "mad", "iqr", "cv", "skewness", "se.skewness", "kurtosis", "notNullValues", "simulationSteps")
fwrite(statsToPrint, "G:/Hanna/stats_affinity_64_48_3_2.csv")
```

```{r new config, eval=FALSE, include=FALSE}
config <- newConfig
```

```{r update config, eval=FALSE, include=FALSE}
config <- rbind(newConfig)

```

```{r write whole config with stats and without paths to file, eval=FALSE, include=FALSE}
configToPrint <- config
configToPrint$livingAarsPath <- NULL
configToPrint$aarsPath <- NULL
configToPrint$mrnaPath <- NULL
configToPrint$livingAarsDir <- NULL
fwrite(configToPrint, "G:/Hanna/config_stats_affinity_64_48_3_2.csv")
```

```{r write fitness to file, eval=FALSE, include=FALSE}
fitnessToPrint <- originalFitnessData
fitnessToPrint <- lapply(fitnessToPrint, function(x) {if(length(x) == 2000) {y = vector(mode="numeric", length=98000); c(x,y)}else{x}})
fwrite(fitnessToPrint, "G:/Hanna/fitnessData_affinity_64_48_3_2.csv", nThread = 20)
```

```{r load config, include=FALSE}
config <- data.table::fread("G:/Hanna/config_stats_affinity_64_48_3_2.csv")
```

## Some start explanations
MRNA does mean pre-mRNA. It is described by the anticodon sequence that would be needed to translate it. Different numbers of existing mRNA are examined. The model doesn't consider the influence of mRNA changes like mutations and concentration changes. Therefore the existing mRNA is a constant, set in the beginning of the simulation.

##Description of config

#### End state

There are four possible end states:

Dead: The cell has died after the simulated steps or earlier.

Metric: notNullValues != simulationSteps

Alive: The cell has reached an omptimal fitness of 1.0 and therefore the simulation resulted in an stable code.

Metrics: notNullValues == simulationSteps & max == 1.0 

Steady: The cell is alive and the genetic code is stable but ambiguous.

Metrics: notNullValues == simulationSteps & max != 1.0 & med == q3

Unsteady: The cell is alive and the genetic code is not stable.

Metrics: notNullValues == simulationSteps & max != 1.0 & med != q3

#### Other parameters

notNullValues: number of fitness values that are not null

simulationSteps: number of simulated cell generations

### Summary of the whole table
```{r echo=FALSE}
descr(config, round.digits = 2, style="rmarkdown")
```



## Analysis of the Miniexample simulations
Simulationsteps: 2000

Codon numbers: 2, 3

The set of cells with a steady end state has a significantly higher fitness than the ones with an unsteady end state.

####Steady set vs. unsteady set
```{r unsteady vs. steady}
unsteady.means <- config$mean[which(config$endState == "unsteady")]
steady.means <- config$mean[which(config$endState == "steady")]

t.test(unsteady.means, steady.means)
```
A boxplot shows this clear difference:
```{r}
boxplot(unsteady.means, steady.means)
```

```{r 1.0 as max lower q3}
values <- factor(round(config$q3[which(config$endState == "alive" & config$q3 != 1.0)],3))
values <- data.frame(values)
colnames(values)[1] <- "means"
valuesTab <- as.data.frame(table(values))
colnames(valuesTab)[1] <- "means"
ggplot(values) + geom_bar(aes(means,fill=means)) + geom_text(data = valuesTab, aes(x=means, y=Freq, label = Freq, vjust = -0.5)) + theme(legend.position="none")+ ggtitle("Barplot showing the counts of cells with 1.0 as max fitness but lower q3")

```


```{r miniexamples, eval=FALSE, include=FALSE}
plot(config$codonNumb[which(config$endState == "unsteady")], unsteady.means, col = "darkgreen", ylim = c(0,1), xlim = c(2,3.5))

boxplot(config$mean[which(config$endState == "unsteady" & config$codonNumb == 3)], config$mean[which(config$endState == "unsteady" & config$codonNumb == 2)])


geom_boxplot(outlier.colour="black", outlier.shape=16,
             outlier.size=2, notch=FALSE)
p <- ggplot(config, aes(x=endState, y=mean)) + 
  geom_boxplot()

ggplot(data.frame(values), aes(x=values)) + geom_bar(fill="orange",aes(y=..count../sum(..count..)), labels = TRUE)

steady <- which(config$notNullValues == config$simulationSteps & config$simulationSteps == 2000 & config$max != 1.0 & config$med == config$q3)
lines((config$codonNumb[steadyEndValues])+0.05, steadyEndValues.means, col = "orange", ylim = c(0,1), xlim = c(2,3.5), type = "p")

allLiving <- which(config$notNullValues == config$simulationSteps & config$simulationSteps == 2000)
lines((config$codonNumb[allLiving])+0.1, config$mean[allLiving], col = "red", ylim = c(0,1), xlim = c(2,3.5), type = "p")

allLivingCn2 <- which(config$notNullValues == config$simulationSteps & config$simulationSteps == 2000 & config$codonNumb == 2)

allLivingCn3 <- which(config$notNullValues == config$simulationSteps & config$simulationSteps == 2000 & config$codonNumb ==3)

t.test(config$mean[allLivingCn2],  config$mean[allLivingCn3])


```


```{r scatter plots, eval=FALSE, include=FALSE}
scatter.smooth(aggregate(newConfig$mean~factor(newConfig$geneNumb), FUN=mean)[,2],as.numeric(paste(levels(aggregate(newConfig$mean~factor(newConfig$geneNumb), FUN=mean)[,1]))))

p <- data.table("x" = aggregate(newConfig$mean~factor(newConfig$geneNumb), FUN=mean)[,2], "y" = as.numeric(paste(levels(aggregate(newConfig$mean~factor(newConfig$geneNumb), FUN=mean)[,1]))))
                
car::scatterplot(p$x, p$y)  

p <- aggregate(newConfig$mean~factor(newConfig$geneNumb)+factor(newConfig$initAaNumb), FUN=mean)
car::scatter3d(p[,1], p[,2], p[,3])  
p <- aggregate(newConfig$mean~factor(newConfig$aarsLifeticksStartValue)+factor(newConfig$initAaNumb), FUN=mean)
car::scatter3d(p[,1], p[,2], p[,3])  
```

```{r graph, eval=FALSE, include=FALSE}
graphData <- unique(data.table("h" = newConfig$initAaNumb, "m" = newConfig$codonNumb))
graphData <- as.matrix(graphData)
graphData <- graph.edgelist(graphData)
V(graphData) # vertices
E(graphData) # edges
gsize(graphData) # number of edges
gorder(graphData) # number of vertices
plot(graphData)
plot(induced_subgraph(graphData, c(3,4,8,10,16,20, 48,64,1,2,5)))
plot(induced_subgraph(graphData, c(48,64, 20, 16,8)))
set_vertex_attr(graphData, "initAaNumb", value = newConfig$initAaNumb)
set_vertex_attr(graphData, "codonNumb", value = newConfig$codonNumb)
vertex_attr(graphData)
```


```{r eval=FALSE, include=FALSE}
maxMeans_64 <- conf[conf$Mean == max(conf$Mean)]
meanIsMedian_64_not0or1 <-  config[config$Mean == config$Median & config$Mean != 0.0 & config$Mean != 1.0]
meanIsMedian_64_0 <-  config[config$Mean == config$Median & config$Mean == 0.0]
meanIsMedian_64_1 <- config[config$Mean == config$Median & config$Mean == 1.0]
plot(meanIsMedian_64_0$Mean, fitness[[meanIsMedian_64_0$ids]])

fitness[meanIsMedian_64_1$ids]
```

```{r find repetetive sequences, eval=FALSE, include=FALSE}
# if cell didn't die
if(notNullValues == length(fitnessValues)){
  # check if there are repetitive values
  counted <- rle(fitnessValues)
  counted$values[counted$lengths != 1]
}

repetetiveData <- data.table()
for(pos in c(1:length(fitness))){
  # if cell didn't die
  if(newConfig$notNullValues[pos] == newConfig$simulationSteps[pos]){
    rleResult <- rle(fitness[[pos]])
    rleLengths <- rleResult$lengths
    rleValues <- rleResult$values
    # delete information about numbers that occur just once
    rleLengtshNotOne <- rleLengths != 1
    rleLengths <- rleLengths[rleLengtshNotOne]
    # if there are two or more numbers that appear more than one time it could be a repetitive sequence with length two or longer
    if(length(rleLengths) > 2){
     rleValues <- rleValues[rleLengtshNotOne]
     repetetiveData <- rbind(repetetiveData, data.table("ids" = pos, "lengths" = rleLengths, "values" = rleValues))
    }
  }
}

# get the row numbers of the fitness data that includes repetetive values
#repIds <- unique(repetetiveData$ids)
# get only the data from still living cells
repIds <- unique(repetetiveData$ids[repetetiveData$ids %in% which(newConfig$notNullValues == 100000)])
repetetiveDataAlive <- repetetiveData[repetetiveData$ids %in% repIds]
# get the data that includes repetetive values, be careful to not take the repIds but their value (= the original row number)
fitnessDataWithRep <- sapply(1:length(repIds), FUN = function (pos){fitness[repIds[pos]]})

for(pos in c(1:length(repetetiveDataAlive))){
  valueToCheck <- repetetiveDataAlive[pos]$values
  # get position in fitnessDataWithRep
  pos <- repetetiveDataAlive[pos]$ids
  posInFtData <- which((fitnessDataWithRep[[which(repIds == pos)]] == valueToCheck)== TRUE)
  
}


which((round(fitnessDataWithRep[18][[1]],7) == 0.1670015)==TRUE)

 round(repetetiveData$values[repetetiveData$id == 2303],7) == 0.1689546

# rleValues <- sapply(1:length(fitness), FUN = function(pos){rleResult <- rle(fitness[[pos]]); y <- rleResult$values[rleResult$lengths != 1]; if(length(y)!= 0){rleResult} else{NULL}})
# 
# tree <- sapply(1:length(fitness), FUN = function(pos){x <- rle(fitness[[pos]]); y <- x$values[x$lengths != 1]; if(length(y)!= 0){TRUE} else{FALSE}})
# p <- p[tree]
# ids <- ids[tree]
# 
# tree <- sapply(1:length(p), FUN = function(pos){if(length(p[[pos]]$lengths)>=2){TRUE} else{FALSE}})
# p <- p[tree]
# ids <- ids[tree]
# data <- fitness[ids]
# 
# opts <- data.table()
# for(pos in c(1:length(p))){
#   opts <- rbind(opts,data.table("ids" = ids[pos], "lengths" = p[[pos]]$lengths, "values" = p[[pos]]$values, "fitnessData" = data[pos]))
# }
```

```{r eval=FALSE, include=FALSE}
# median same as last value -> probably same value forever (stabiler Zustand)
# if in this case 3rd Quartile is not same as median then it is mostly stable but sometimes there happen changes that change back after some steps
```

```{r regression models, eval=FALSE, include=FALSE}
regression <- function (param, paramValues){ 
mean <- config$mean[which(config$codonNumb == 64)]
plot(param, mean)

exp.model <- lm(log(mean) ~ param)
predictedCounts <- predict(exp.model, list(param=paramValues))
lines(paramValues, predictedCounts, col = "orange", lwd = 3)

paramSquare <- param^2
quadratic.model <- lm(mean ~ param + paramSquare)
predictedCounts <- predict(quadratic.model, list(param=paramValues, paramSquare=paramValues^2))
lines(paramValues, predictedCounts, col = "red", lwd = 3)

linear.model <- lm(mean ~ param)
predictedCounts <- predict(linear.model, list(param=paramValues))
lines(paramValues, predictedCounts, col = "darkgreen", lwd = 3)

print("linear model summary")
print(summary(linear.model))
print("quadratic model summary")
print(summary(quadratic.model))
print("exponential model summary")
print(summary(exp.model))

}

#meanValues <- seq(0, 1, 0.01)

#regression(config$codonNumb)
regression(config$geneNumb[which(config$codonNumb == 64)], seq(1, 30, 1))
regression(config$initAaNumb[which(config$codonNumb == 64)], seq(1, 30, 1))
regression(config$maxAnticodonNumb[which(config$codonNumb == 64)], seq(1, 8, 1))
regression(config$aarsLifeticksStartValue[which(config$codonNumb == 64)], seq(1, 30, 1))
regression(config$livingAarsStartNumb[which(config$codonNumb == 64)], seq(1, 30, 1))


```


```{r ANOVA, eval=FALSE, include=FALSE}
#fitnessRow <- fitness[[which.max(config$Mean)]]

geneNumb30 <- config$mean[which(config$geneNumb == 30)]
geneNumb30Mean <- mean(geneNumb30)

geneNumb15 <- config$mean[which(config$geneNumb == 15)]
geneNumb15Mean <- mean(geneNumb15)

t.test(config$mean[which(config$geneNumb == 30)], config$mean[which(config$geneNumb == 15)], var.equal = TRUE)

library(tidyverse)
#tibble(config)
anovaData <- select(config, aarsLifeticksStartValue, geneNumb, mean)
anovaData <- anovaData[which(anovaData$geneNumb == 30)]

anovaData <- select(config, aarsLifeticksStartValue, mean)

library(psych)
description <- describeBy(anovaData, anovaData$aarsLifeticksStartValue)
description
boxplot(anovaData$mean ~ anovaData$aarsLifeticksStartValue, main = "Boxplot", xlab = "Group (ltStartValue)", ylab = "Mean", outline = TRUE)

# Inter group variance

# Define number of subjects in each group
##n <- description[[1]]$n
n <- 4320#length(which(anovaData$aarsLifeticksStartValue == 2))

# Calculate group means
y_j <- tapply(anovaData$mean, anovaData$aarsLifeticksStartValue, mean)

# Calculate the grand mean
y_t <- mean(y_j)

# Calculate the sum of squares
ss_a <- n*sum((y_j - y_t)^2)

# Intra group variance

# Create a separate vector of Means for each training group
y_i1 <- subset(anovaData$Mean, anovaData$aarsLifeticksStartValue == 2)
y_i2 <- subset(anovaData$Mean, anovaData$aarsLifeticksStartValue == 5)
y_i3 <- subset(anovaData$Mean, anovaData$aarsLifeticksStartValue == 10)
y_i4 <- subset(anovaData$Mean, anovaData$aarsLifeticksStartValue == 15)

# Subtract group means from the individual values
s_1 <- y_i1 - y_j[1]
s_2 <- y_i2 - y_j[2]
s_3 <- y_i3 - y_j[3]
s_4 <- y_i4 - y_j[4]

# Put everything back together into one vector
s_t <- c(s_1, s_2, s_3, s_4)

# Calculate the sum of squares using s_t
ss_sa <- sum(s_t^2)

# calculate F-Value

# Number of groups
a <- 4

# Define degrees of freedom
df_a <- a - 1
df_sa <- a*(n-1)

# Calculate mean squares using ss_a and ss_sa
ms_a <- ss_a / df_a
ms_sa <- ss_sa / df_sa

# Calculate the F-ratio
f_rat <- ms_a / ms_sa

f_rat

anovaResult <- aov(mean ~ factor(aarsLifeticksStartValue) + factor(geneNumb), data = anovaData)
anovaSummary <- summary(anovaResult)

anovaSummary
summary(aov(mean ~ factor(geneNumb) + factor(aarsLifeticksStartValue) , data = anovaData))
drop1(anovaResult,~.,test="F")
plot(anovaResult)
TukeyHSD(anovaResult)

pairwise.t.test(anovaData$mean, anovaData$aarsLifeticksStartValue, p.adjust.method = "bonferroni")
TukeyHSD(aov(mean ~ factor(geneNumb) + factor(aarsLifeticksStartValue) , data = anovaData))


#library(mvoutlier)
#which(config$geneNumb == 30, arr.ind = FALSE, useNames = FALSE)
```

```{r Two-way Interaction Plot, echo=FALSE, warning=FALSE}
 
attach(config)
lt <- factor(aarsLifeticksStartValue)
gn <- factor(geneNumb)
interaction.plot(gn, lt, mean, type="b", col=c(1:3), 
   leg.bty="o", leg.bg="beige", lwd=2, pch=c(18,24,22), 
   xlab="geneNumb", 
   ylab="Mean", 
   main="Two-way Interaction Plot")
detach(config)
```

```{r Meanplot, echo=FALSE, warning=FALSE}
library(gplots)
plotmeans(config$mean~factor(config$aarsLifeticksStartValue) ,xlab="geneNumb",ylab="mean", main="Meanplot")
plotmeans(config$mean~factor(config$maxAnticodonNumb) ,xlab="geneNumb",ylab="mean", main="Meanplot")

```



```{r eval=FALSE, include=FALSE}
#data <- tail(data$V1,length(data$V1)-20)
#data
#summary(data)
#data <- tail(data, 1000)

data <- config$Mean
norm <- rnorm(length(data), mean(data), sd(data))
chisq.test(data, norm)
```




```{r eval=FALSE, include=FALSE}
# for WEKA
conf <- config[which(config$codonNumb == 64)]
#nominalMeans <- config$Mean >
mainData <- data.frame(geneNumb = conf$geneNumb, initAaNumb = conf$initAaNumb, similarAars = conf$similarAars, maxAnticodonNumb = conf$maxAnticodonNumb, aarsLifeticksStartValue = conf$aarsLifeticksStartValue, livingAarsStartNumb = conf$livingAarsStartNumb, mean = conf$Mean)


cutResult = cut(config$Mean, 10, ordered_result = TRUE)
levels(cutResult)

fun <- function(listElement){
value <- listElement
if(listElement <= 0.1) value = 0.1
else if(listElement <= 0.2) value = 0.2
  else if(listElement <= 0.3) value = 0.3
  else if(listElement <= 0.4) value = 0.4
  else if(listElement <= 0.5) value = 0.5
  else if(listElement <= 0.6) value = 0.6
  else if(listElememt <= 0.7) value = 0.7
  else if(listElement <= 0.8) value = 0.8
  else if(listElement <= 0.9) value = 0.9
  else if(listElement <= 1.0) value = 1.0
return(value)
}


conf <- config[which(config$codonNumb == 64),]
# copy mean values into new columne and make them nominal
nominalMean <- conf$Max
nominalMean[nominalMean <= 0.1] <- 0.1
nominalMean[nominalMean <= 0.2 & nominalMean >0.1] <- 0.2
nominalMean[nominalMean <= 0.3 & nominalMean >0.2] <- 0.3
nominalMean[nominalMean <= 0.4 & nominalMean >0.3] <- 0.4
nominalMean[nominalMean <= 0.5 & nominalMean >0.4] <- 0.5
nominalMean[nominalMean <= 0.6 & nominalMean >0.5] <- 0.6
nominalMean[nominalMean <= 0.7 & nominalMean >0.6] <- 0.7
nominalMean[nominalMean <= 0.8 & nominalMean >0.7] <- 0.8
nominalMean[nominalMean <= 0.9 & nominalMean >0.8] <- 0.9
nominalMean[nominalMean <= 1.0 & nominalMean >0.9] <- 1.0
conf <- cbind(conf, nominalMean)


mainData <- data.frame(geneNumb = conf$geneNumb, initAaNumb = conf$initAaNumb, similarAars = conf$similarAars, maxAnticodonNumb = conf$maxAnticodonNumb, aarsLifeticksStartValue = conf$aarsLifeticksStartValue, livingAarsStartNumb = conf$livingAarsStartNumb, mean = conf$Mean)


#nominalConf <- lapply(conf$Mean, fun)

#nicePart <- config[codonNumb == 24][geneNumb == 30][Mean > 0.2]

#nominalConf <- lapply(nicePart[c(1:length(nicePart))]$Mean, fun)

#conf[which(config$Mean >= 0.1)]

#conf$Mean <= 0.1

fwrite(mainData, "G:/Hanna/data_affinity_64_numericMean.csv")
```

```{r tries, eval=FALSE, include=FALSE}
max(newConfig$notNullValue[which(newConfig$simulationSteps != newConfig$notNullValues)])
  newConfig[which(newConfig$notNullValues == 99555)]
  plot(unique(newConfig$notNullValue[which(newConfig$simulationSteps != newConfig$notNullValues)]))
  rle(newConfig$notNullValues[which(newConfig$notNullValues == newConfig$aarsLifeticksStartValue & newConfig$simulationSteps != newConfig$notNullValues)])
  # set up the plot 
plot(c(2000:100000), c(2000:100000), type="n", xlab="Age (days)",
     ylab="Circumference (mm)" ) 
    lines(newConfig$simulationSteps,newConfig$notNullValues, type="b", lwd=1.5) 
    hist(newConfig$notNullValues[which(newConfig$notNullValues< 1000)])
    
    hist(newConfig$notNullValues[which(newConfig$notNullValues< 50 & newConfig$notNullValues > 0)], breaks = 50, col = c("darkGreen", "red"))
    
    newConfig$geneNumb <- factor(newConfig$geneNumb, ordered = TRUE)
    table(newConfig$geneNumb)
    barplot(table(newConfig$geneNumb))
    
    summary(newConfig)
    
    plot(factor(newConfig$geneNumb), newConfig$Mean)
    
    
    
    
par(mfrow=c(1,1)) # all plots on one page 
 plot(factor(newConfig$livingAarsStartNumb), newConfig$Mean)
 plot(factor(newConfig$aarsLifeticksStartValue), newConfig$Mean)
 plot(factor(newConfig$codonNumb), newConfig$Mean)
 plot(factor(newConfig$geneNumb), newConfig$Mean)
 plot(factor(newConfig$initAaNumb), newConfig$Mean)
 plot(factor(newConfig$maxAnticodonNumb), newConfig$Mean)
 plot(factor(newConfig$similarAars), newConfig$Mean)
 plot(factor(newConfig$simulationSteps), newConfig$Mean)
 
 
 
boxplot(newConfig$Mean ~ factor(newConfig$geneNumb))
means <- by(newConfig$Mean, factor(newConfig$geneNumb), mean) 
points(1:8, means, pch = 10, cex = 0.75, bg = "red")
text(1:8 - 0.5, means, labels = formatC(means, format = "f", digits = 2), pos = 4, cex = 0.9, col = "red")
 



# Create Line Chart

# convert factor to numeric for convenience 
factor1 <- as.numeric(factor(newConfig$codonNumb))
ntrees <- max(factor1)

# get the range for the x and y axis 
xrange <- range(newConfig$Mean) 
yrange <- range(newConfig$livingAarsStartNumb) 

# set up the plot 
plot(xrange, yrange, type="n", xlab="Mean",
   ylab="livingAarsStartNumb" ) 
colors <- rainbow(ntrees) 
linetype <- c(1:ntrees) 
plotchar <- seq(18,18+ntrees,1)

# add lines 
for (i in 1:ntrees) { 
  tree <- subset(newConfig, factor1==i) 
  lines(tree$Mean, tree$livingAarsStartNumb, type="o", lwd=1.5,
    lty=linetype[i], col=colors[i], pch=plotchar[i]) 
} 

# add a title and subtitle 
title("Tree Growth", "example of line plot")

# add a legend 
legend(xrange[1], yrange[2], levels(factor(newConfig$codonNumb)), cex=0.8, col=colors,
   pch=plotchar, lty=linetype, title="Tree")




    # if cell didn't die
    if(notNullValues == length(fitnessValues)){
      # check if there are repetitive values
      rleResult <- rle(fitnessValues)
      fitnessIds <- row
      lengths[row] <- rleResult$lengths
      values[row] <- rleResults$values
      
      #counted$values[counted$lengths != 1]
      fitness[[row]] <- tail(fitnessValue, length(fitnessValue)-20)
    }else{
      fitness[[row]] <- fitnessValues[which(fitnessValues > 0)]
    }
  }
  counted <- data.table("fitnessIds" = fitnessIds, "lengths" = lengths, "values" = values)



```

```{r filled contour, eval=FALSE, include=FALSE}
theData <- data.table(livingAarsStartNumb, geneNumb, codonNumb, mean) %>% 
    group_by(codonNumb, livingAarsStartNumb, geneNumb) %>% 
    dplyr::summarize(statistic=mean(mean, na.rm = TRUE))

ggplot(theData, aes(codonNumb, livingAarsStartNumb)) +
    
    coord_cartesian(xlim = c(0,64), ylim = c(0,30)) +
    scale_x_continuous(breaks = seq(0,64)) +
    scale_y_continuous(breaks = seq(0,30))+
    
    geom_tile(aes(fill=statistic))+
    guides(fill=guide_legend(title='Legend'))+
    
    theme(
        panel.background = element_rect(fill= 'white', color = 'white'),
        panel.grid.major = element_line(color='#E0E0E0'),
        panel.grid.minor = element_line(color='#E0E0E0')
    )+
    
    facet_wrap(~factor(geneNumb))+
    scale_fill_gradientn(colors = rainbow(100))
```


```{r}

hm <- lm(mean ~ factor(initAaNumb) * factor(aarsLifeticksStartValue) * factor(similarAars) * factor(livingAarsSeed), data = configLiving)

hm$model$mean


boxplot(mean ~ factor(initAaNumb) * factor(aarsLifeticksStartValue) * factor(similarAars) * factor(livingAarsSeed), data = configLiving)
means <- hm$model$mean
points(1:8, means, pch = 10, cex = 0.75, bg = "red")
text(1:8 - 0.5, means, labels = formatC(means, format = "f", digits = 2), pos = 4, cex = 0.9, col = "red")
```





